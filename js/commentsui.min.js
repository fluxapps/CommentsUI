il.CommentsUI=function(a="",b=!1,c=""){this.element=$("#"+a),this.readonly=b,this.async_base_url=c,this.init()},il.CommentsUI.INSTANCES=[],il.CommentsUI.newInstance=function(a="",b=!1,c=""){this.INSTANCES.push(new this(a,b,c))},il.CommentsUI.prototype={constructor:il.CommentsUI,async_base_url:"",element:null,LANGUAGES:{},readonly:!1,createComment:function(a,b,c){$.ajax({type:"post",url:this.async_base_url+"&cmd=createComment",data:a,success:function(a){b(a),this.getCommentsUpdate([a])}.bind(this),error:c})},deleteComment:function(a,b){$.ajax({type:"post",url:this.async_base_url+"&cmd=deleteComment&comment_id="+a.id,success:function(){b.remove()},error:function(){}})},getComments:function(a,b){$.ajax({type:"get",url:this.async_base_url+"&cmd=getComments",success:function(b){a(b),this.getCommentsUpdate(b)}.bind(this),error:b})},getCommentsUpdate:function(a){this.readonly||a.forEach(function(a){var b=$(".comment[data-id="+a.id+"]",this.element),c=$(" .actions",b);if(a.deletable){var d=$("<button/>",{class:"action delete",text:this.txt("deleteText")});d.on("click",this.deleteComment.bind(this,a,b)),c.append(d)}if(a.shareable){var e=$("<button/>",{class:"action share",text:this.txt("shareText")});e.on("click",this.shareComment.bind(this,a,e,d)),c.append(e)}},this)},init:function(){this.readonly&&this.element.addClass("readonly");var a={enableEditing:!this.readonly,forceResponsive:!1,enableAttachments:!1,enableDeleting:!1,enableDeletingCommentWithReplies:!1,enableHashtags:!1,enableNavigation:!1,enablePinging:!1,enableReplying:!1,enableUpvoting:!1,postCommentOnEnter:!1,readOnly:this.readonly,getComments:this.getComments.bind(this),postComment:this.createComment.bind(this),putComment:this.updateComment.bind(this),timeFormatter:function(a){return new Date(a).toLocaleTimeString()}};Object.keys(il.CommentsUI.LANGUAGES).forEach(function(b){a[b]||(a[b]=this.txt(b))},this),this.element.comments(a)},shareComment:function(a,b,c){$.ajax({type:"post",url:this.async_base_url+"&cmd=shareComment&comment_id="+a.id,success:function(a){b.remove(),c&&c.remove(),this.getCommentsUpdate([a])}.bind(this),error:function(){}})},txt:function(a){return il.CommentsUI.LANGUAGES[a]},updateComment:function(a,b,c){$.ajax({type:"post",url:this.async_base_url+"&cmd=updateComment&comment_id="+a.id,data:a,success:function(a){b(a),this.getCommentsUpdate([a])}.bind(this),error:c})}};