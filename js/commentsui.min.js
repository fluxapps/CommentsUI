il.CommentsUI=function(a="",b=!1,c=""){this.element=$("#"+a),this.readonly=b,this.async_base_url=c,this.init()},il.CommentsUI.INSTANCES=[],il.CommentsUI.newInstance=function(a="",b=!1,c=""){this.INSTANCES.push(new this(a,b,c))},il.CommentsUI.prototype={constructor:il.CommentsUI,async_base_url:"",element:null,readonly:!1,createComment:function(a,b,c){$.ajax({type:"post",url:this.async_base_url+"&cmd=createComment",data:a,success:function(a){b(a)},error:c})},deleteComment:function(a,b){$.ajax({type:"post",url:this.async_base_url+"&cmd=deleteComment&comment_id="+a.id,success:function(){b.remove()},error:function(){}})},getComments:function(a,b){$.ajax({type:"get",url:this.async_base_url+"&cmd=getComments",success:function(b){a(b),this.getCommentsUpdate(b)}.bind(this),error:b})},getCommentsUpdate:function(a){this.readonly||a.forEach(function(a){var b=$(".comment[data-id="+a.id+"]",this.element),c=$(" .actions",b);if(a.deletable){var d=$("<button/>",{class:"action delete",text:"Delete"});d.on("click",this.deleteComment.bind(this,a,b)),c.append(d)}if(!a.is_shared){var e=$("<button/>",{class:"action share",text:"Share"});e.on("click",this.shareComment.bind(this,a,e)),c.append(e)}},this)},init:function(){this.readonly&&this.element.addClass("readonly"),this.element.comments({enableEditing:!this.readonly,forceResponsive:!1,enableAttachments:!1,enableDeleting:!1,enableDeletingCommentWithReplies:!1,enableHashtags:!1,enableNavigation:!1,enablePinging:!1,enableReplying:!1,enableUpvoting:!1,postCommentOnEnter:!1,readOnly:this.readonly,getComments:this.getComments.bind(this),postComment:this.createComment.bind(this),putComment:this.updateComment.bind(this)})},shareComment:function(a,b){$.ajax({type:"post",url:this.async_base_url+"&cmd=shareComment&comment_id="+a.id,success:function(){b.remove()},error:function(){}})},updateComment:function(a,b,c){$.ajax({type:"post",url:this.async_base_url+"&cmd=updateComment&comment_id="+a.id,data:a,success:function(a){b(a)},error:c})}};